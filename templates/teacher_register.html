{% extends "base.html" %}

{% block title %}Teacher Registration - SmartAttendance{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 py-8">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-secondary to-green-600 text-white text-center py-8">
                <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-chalkboard-teacher text-2xl"></i>
                </div>
                <h1 class="text-3xl md:text-4xl font-bold mb-2">Teacher Registration</h1>
                <p class="text-green-100 text-lg">Join our smart attendance management system</p>
            </div>

            <div class="p-8">
                <form method="POST" enctype="multipart/form-data" id="teacherForm" class="space-y-8">
                    <!-- Personal Information -->
                    <div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                            <i class="fas fa-user mr-3 text-secondary"></i>Personal Information
                        </h3>

                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label for="teacher_id" class="block text-sm font-semibold text-gray-700 mb-2">
                                    Teacher ID *
                                </label>
                                <input type="text" id="teacher_id" name="teacher_id" required
                                       placeholder="e.g., TCH001"
                                       class="input-field">
                            </div>

                            <div>
                                <label for="name" class="block text-sm font-semibold text-gray-700 mb-2">
                                    Full Name *
                                </label>
                                <input type="text" id="name" name="name" required
                                       placeholder="Enter your full name"
                                       class="input-field">
                            </div>

                            <div>
                                <label for="email" class="block text-sm font-semibold text-gray-700 mb-2">
                                    Email Address *
                                </label>
                                <input type="email" id="email" name="email" required
                                       placeholder="your.email@institution.edu"
                                       class="input-field">
                            </div>

                            <div>
                                <label for="phone" class="block text-sm font-semibold text-gray-700 mb-2">
                                    Phone Number *
                                </label>
                                <input type="tel" id="phone" name="phone" required
                                       placeholder="+1234567890"
                                       class="input-field">
                            </div>
                        </div>
                    </div>

                    <!-- Professional Information -->
                    <div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                            <i class="fas fa-briefcase mr-3 text-primary"></i>Professional Information
                        </h3>

                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label for="department" class="block text-sm font-semibold text-gray-700 mb-2">
                                    Department *
                                </label>
                                <select id="department" name="department" required class="input-field">
                                    <option value="">Select Department</option>
                                    <option value="Computer Science">Computer Science</option>
                                    <option value="Information Technology">Information Technology</option>
                                    <option value="Electronics">Electronics Engineering</option>
                                    <option value="Mechanical">Mechanical Engineering</option>
                                    <option value="Civil">Civil Engineering</option>
                                    <option value="Electrical">Electrical Engineering</option>
                                    <option value="Mathematics">Mathematics</option>
                                    <option value="Physics">Physics</option>
                                    <option value="Chemistry">Chemistry</option>
                                    <option value="Business">Business Administration</option>
                                </select>
                            </div>

                            <div>
                                <label for="subject" class="block text-sm font-semibold text-gray-700 mb-2">
                                    Primary Subject *
                                </label>
                                <input type="text" id="subject" name="subject" required
                                       placeholder="e.g., Data Structures"
                                       class="input-field">
                            </div>
                        </div>
                    </div>

                    <!-- Photo Upload -->
                    <div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                            <i class="fas fa-camera mr-3 text-accent"></i>Face Recognition Setup
                        </h3>

                        <div class="bg-blue-50 border-l-4 border-secondary p-4 mb-6 rounded-r-lg">
                            <div class="flex">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-info-circle text-secondary"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-blue-700">
                                        Photo upload is optional for teachers. You can add it later if needed.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div>
                            <label for="photo" class="block text-sm font-semibold text-gray-700 mb-2">
                                Upload Photo (Optional)
                            </label>
                            <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg hover:border-secondary transition-colors duration-200">
                                <div class="space-y-1 text-center">
                                    <div id="upload-icon" class="mx-auto">
                                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                                    </div>
                                    <div class="flex text-sm text-gray-600">
                                        <label for="photo" class="relative cursor-pointer bg-white rounded-md font-medium text-secondary hover:text-green-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-secondary">
                                            <span>Upload a file</span>
                                            <input id="photo" name="photo" type="file" class="sr-only" accept="image/*">
                                        </label>
                                        <p class="pl-1">or drag and drop</p>
                                    </div>
                                    <p class="text-xs text-gray-500">PNG, JPG, JPEG up to 5MB</p>
                                </div>
                            </div>
                        </div>

                        <!-- Photo Preview -->
                        <div id="photo-preview" class="mt-6 text-center hidden">
                            <img id="preview-image" src="" alt="Photo Preview"
                                 class="max-w-xs max-h-64 rounded-lg shadow-lg border-4 border-green-200 mx-auto">
                            <p class="text-green-600 mt-2 font-semibold">
                                <i class="fas fa-check-circle mr-1"></i>Photo uploaded successfully!
                            </p>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="flex flex-col sm:flex-row gap-4 justify-center pt-6">
                        <button type="submit" class="btn-secondary text-lg py-4 px-8">
                            <i class="fas fa-user-plus mr-2"></i>
                            Register Teacher
                        </button>
                        <a href="{{ url_for('index') }}" class="btn-outline text-lg py-4 px-8 text-center">
                            <i class="fas fa-arrow-left mr-2"></i>
                            Back to Home
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Loading Modal -->
<div id="loading-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-8 text-center">
        <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-secondary mx-auto mb-4"></div>
        <h3 class="text-lg font-semibold text-gray-900 mb-2">Processing Registration</h3>
        <p class="text-gray-600">Please wait while we process your face recognition data...</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('teacherForm');
    const photoInput = document.getElementById('photo');
    const previewContainer = document.getElementById('photo-preview');
    const previewImage = document.getElementById('preview-image');
    const uploadIcon = document.getElementById('upload-icon');
    const loadingModal = document.getElementById('loading-modal');

    // Photo preview functionality
    photoInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('Please select a valid image file.');
                return;
            }

            // Validate file size (5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('File size must be less than 5MB.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                previewImage.src = e.target.result;
                previewContainer.classList.remove('hidden');
                uploadIcon.innerHTML = '<i class="fas fa-check-circle text-4xl text-green-400"></i>';
            };
            reader.readAsDataURL(file);
        }
    });

    // Form validation
    form.addEventListener('submit', function(e) {
        const requiredFields = ['teacher_id', 'name', 'email', 'phone', 'department', 'subject'];
        let isValid = true;

        // Check required fields
        requiredFields.forEach(fieldName => {
            const field = document.getElementById(fieldName);
            if (!field.value.trim()) {
                field.classList.add('border-red-500', 'ring-red-500');
                field.classList.remove('border-gray-300');
                isValid = false;
            } else {
                field.classList.remove('border-red-500', 'ring-red-500');
                field.classList.add('border-gray-300');
            }
        });

        // Photo is now optional for teachers
        // No validation needed for photo

        if (!isValid) {
            e.preventDefault();
            alert('Please fill in all required fields and upload a photo.');
            return;
        }

        // Show loading modal
        loadingModal.classList.remove('hidden');
    });

    // Real-time validation
    const inputs = document.querySelectorAll('input, select');
    inputs.forEach(input => {
        input.addEventListener('input', function() {
            if (this.value.trim()) {
                this.classList.remove('border-red-500', 'ring-red-500');
                this.classList.add('border-gray-300');
            }
        });
    });

    // Drag and drop functionality
    const dropZone = document.querySelector('.border-dashed');
    
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
        dropZone.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, unhighlight, false);
    });

    function highlight(e) {
        dropZone.classList.add('border-secondary', 'bg-green-50');
    }

    function unhighlight(e) {
        dropZone.classList.remove('border-secondary', 'bg-green-50');
    }

    dropZone.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;

        if (files.length > 0) {
            photoInput.files = files;
            photoInput.dispatchEvent(new Event('change'));
        }
    }
});
</script>
{% endblock %}
